<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ "–ó–∞—Ö–≤–∞—Ç –∫–ª–µ—Ç–æ–∫"</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            width: 100vw;
            height: 100vw; /* –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –ø–æ–ª–µ */
            max-width: 600px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
            max-height: 600px;
            margin-top: 10px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
        }
        .cell {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #333;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.3s, border 0.3s;
        }
        .selected {
            border: 2px solid #00f; /* –ë–æ—Ä–¥–µ—Ä –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –∫–ª–µ—Ç–∫–∏ */
        }
        #endTurn {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #endTurn:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>–ò–≥—Ä–∞ "–ó–∞—Ö–≤–∞—Ç –∫–ª–µ—Ç–æ–∫"</h1>
    <button id="endTurn">–•–æ–¥ —Å–¥–µ–ª–∞–Ω</button>
    <div class="grid" id="grid"></div>
    <script>
        const gridElement = document.getElementById('grid');
        const endTurnButton = document.getElementById('endTurn');
        const gridSize = 10;
        let playerCells = [];
        let selectedCell = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—è
        function initGrid() {
            for (let i = 0; i < gridSize; i++) {
                playerCells[i] = [];
                for (let j = 0; j < gridSize; j++) {
                    const count = Math.floor(Math.random() * 5) + 1;
                    const color = Math.random() < 0.5 ? 'üü¶' : 'üü•';
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = i;
                    cell.dataset.y = j;
                    cell.dataset.color = color;
                    cell.dataset.count = count;
                    cell.innerText = `${color}√ó${count}`;
                    cell.style.backgroundColor = getCellColor(count, color);
                    cell.addEventListener('click', handleCellClick);
                    gridElement.appendChild(cell);
                    playerCells[i][j] = { color, count };
                }
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∫–ª–µ—Ç–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —é–Ω–∏—Ç–æ–≤
        function getCellColor(count, color) {
            const shade = Math.floor((count / 10) * 255);
            return color === 'üü¶' ? `rgba(0, 0, ${shade}, 0.5)` : `rgba(${shade}, 0, 0, 0.5)`;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ
        function handleCellClick(event) {
            const cell = event.target;
            const x = parseInt(cell.dataset.x);
            const y = parseInt(cell.dataset.y);
            const cellData = playerCells[x][y];

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–ª–µ—Ç–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∏–≥—Ä–æ–∫—É
            if (cellData.color === 'üü¶') {
                if (selectedCell) {
                    if (selectedCell === cell) {
                        // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                        selectedCell.classList.remove('selected');
                        selectedCell = null;
                    } else if (areAdjacent(selectedCell, cell)) {
                        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —é–Ω–∏—Ç–æ–≤
                        moveUnits(selectedCell.dataset, { x, y });
                        selectedCell.classList.remove('selected');
                        selectedCell = null;
                    }
                } else {
                    // –í—ã–±–æ—Ä –∫–ª–µ—Ç–∫–∏
                    selectedCell = cell;
                    cell.classList.add('selected');
                }
            } else if (cellData.color === 'üü•') {
                // –ê—Ç–∞–∫–∞ –Ω–∞ –∫—Ä–∞—Å–Ω—É—é –∫–ª–µ—Ç–∫—É
                if (selectedCell && areAdjacent(selectedCell, cell)) {
                    attackCell(selectedCell.dataset, { x, y });
                    selectedCell.classList.remove('selected');
                    selectedCell = null;
                }
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è—é—Ç—Å—è –ª–∏ –∫–ª–µ—Ç–∫–∏ —Å–æ—Å–µ–¥–Ω–∏–º–∏
        function areAdjacent(cell1, cell2) {
            const x1 = parseInt(cell1.dataset.x);
            const y1 = parseInt(cell1.dataset.y);
            const x2 = parseInt(cell2.dataset.x);
            const y2 = parseInt(cell2.dataset.y);
            return (Math.abs(x1 - x2) === 1 && y1 === y2) || (Math.abs(y1 - y2) === 1 && x1 === x2);
        }

        // –ê—Ç–∞–∫–∞ –Ω–∞ –∫–ª–µ—Ç–∫—É
        function attackCell(attacker, defender) {
            const attackerX = parseInt(attacker.x);
            const attackerY = parseInt(attacker.y);
            const defenderX = defender.x;
            const defenderY = defender.y;

            const attackerCell = playerCells[attackerX][attackerY];
            const defenderCell = playerCells[defenderX][defenderY];

            let attackingUnits = attackerCell.count - 1; // –û–¥–∏–Ω —é–Ω–∏—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã
            let defendingUnits = defenderCell.count;

            while (attackingUnits > 0 && defendingUnits > 0) {
                const outcome = Math.random();
                const totalUnits = attackingUnits + defendingUnits;
                const attackingChance = attackingUnits / totalUnits;

                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–∞ –±–æ—è
                if (outcome < attackingChance) {
                    defendingUnits--; // –ó–∞—â–∏—Ç–Ω–∏–∫–∏ —Ç–µ—Ä—è—é—Ç —é–Ω–∏—Ç–∞
                } else {
                    attackingUnits--; // –ê—Ç–∞–∫—É—é—â–∏–µ —Ç–µ—Ä—è—é—Ç —é–Ω–∏—Ç–∞
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–µ—Ç–æ–∫ –ø–æ—Å–ª–µ –±–æ—è
            if (defendingUnits <= 0) {
                // –ê—Ç–∞–∫—É—é—â–∏–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –∫–ª–µ—Ç–∫—É
                defenderCell.count = attackingUnits; // –í—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —é–Ω–∏—Ç—ã –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –∫–ª–µ—Ç–∫—É
                defenderCell.color = attackerCell.color; // –¶–≤–µ—Ç –∫–ª–µ—Ç–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Ü–≤–µ—Ç –∞—Ç–∞–∫—É—é—â–µ–≥–æ
                attackerCell.count = 1; // –û–¥–∏–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–ª–µ—Ç–∫–µ –¥–ª—è –∑–∞—â–∏—Ç—ã
            } else {
                // –ó–∞—â–∏—Ç–Ω–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è
                defenderCell.count = defendingUnits; // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤
                attackerCell.count = attackingUnits + 1; // –û–¥–∏–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã
            }

            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–µ—Ç–æ–∫
            updateCellDisplay(attackerX, attackerY);
            updateCellDisplay(defenderX, defenderY);
        }

        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —é–Ω–∏—Ç–æ–≤
        function moveUnits(from, to) {
            const fromX = parseInt(from.x);
            const fromY = parseInt(from.y);
            const toX = to.x;
            const toY = to.y;

            const fromCell = playerCells[fromX][fromY];
            const toCell = playerCells[toX][toY];

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ
            if (fromCell.count > 1) {
                const moveCount = fromCell.count - 1; // –û–¥–∏–Ω –æ—Å—Ç–∞—ë—Ç—Å—è
                if (toCell.count + moveCount <= 10) {
                    // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ
                    toCell.count += moveCount;
                    fromCell.count = 1; // –û–¥–∏–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–ª–µ—Ç–∫–µ
                } else {
                    // –ï—Å–ª–∏ –±–æ–ª—å—à–µ 10, –æ—Å—Ç–∞–≤–ª—è–µ–º –º–∞–∫—Å–∏–º—É–º
                    const excess = (toCell.count + moveCount) - 10;
                    toCell.count = 10;
                    fromCell.count = excess + 1; // –û–¥–∏–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–ª–µ—Ç–∫–µ
                }
                updateCellDisplay(fromX, fromY);
                updateCellDisplay(toX, toY);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–ª–µ—Ç–∫–∏
        function updateCellDisplay(x, y) {
            const cell = gridElement.children[x * gridSize + y];
            const { color, count } = playerCells[x][y];
            cell.innerText = `${color}√ó${count}`;
            cell.style.backgroundColor = getCellColor(count, color);
        }

        // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
        function enemyTurn() {
            let attackMade = false;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª–µ—Ç–∫–∏, –≥–¥–µ –µ—Å—Ç—å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const redCell = playerCells[i][j];
                    if (redCell.color === 'üü•') {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–ª–µ—Ç–∫–∏
                        for (let x = Math.max(0, i - 1); x <= Math.min(gridSize - 1, i + 1); x++) {
                            for (let y = Math.max(0, j - 1); y <= Math.min(gridSize - 1, j + 1); y++) {
                                const blueCell = playerCells[x][y];
                                if (blueCell.color === 'üü¶' && (redCell.count - blueCell.count) >= 2) {
                                    // –ê—Ç–∞–∫–∞ –Ω–∞ –∫–ª–µ—Ç–∫—É —Å –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ–º
                                    attackCell({ x: i, y: j }, { x, y });
                                    attackMade = true;
                                }
                            }
                        }
                    }
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–µ—Ç–æ–∫ –ø–æ—Å–ª–µ —Ö–æ–¥–∞
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (playerCells[i][j].count < 10) {
                        playerCells[i][j].count += 1;
                        updateCellDisplay(i, j);
                    }
                }
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ö–æ–¥–∞
        endTurnButton.addEventListener('click', () => {
            enemyTurn();
        });

        initGrid();
    </script>
</body>
</html>
