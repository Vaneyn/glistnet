<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>GlistPlay ‚Äî –ú–∞–≥–∞–∑–∏–Ω –ø–ª–∞–≥–∏–Ω–æ–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    /* ======== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ======== */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent; /* —É–±–∏—Ä–∞–µ–º —Å–∏–Ω–∏–π –æ—Ç—Ç–µ–Ω–æ–∫ –ø—Ä–∏ —Ç–∞—á–µ */
    }
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: linear-gradient(160deg, #1e1e1e, #333, #444);
      color: #fff;
      min-height: 100vh;
      user-select: none;
      touch-action: manipulation;
    }
    a {
      color: inherit;
      text-decoration: none;
    }
    button {
      font-family: inherit;
      font-size: 1rem;
    }

    /* ======== –•–ï–î–ï–† (–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é) ======== */
    header#main-header {
      position: sticky;
      top: 0;
      background: rgba(30,30,30,0.95);
      padding: 10px 15px;
      display: flex;
      align-items: center;
      z-index: 10;
      border-bottom: 1px solid #555;
    }
    .back-btn-main {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.2rem;
      cursor: pointer;
      margin-right: 12px;
    }
    header#main-header h1 {
      flex: 1;
      font-size: 1.2rem;
      margin: 0;
    }
    .search-container {
      flex: 2;
      position: relative;
    }
    .search-input {
      width: 100%;
      padding: 7px 12px;
      background: rgba(255,255,255,0.1);
      border: 1px solid #666;
      border-radius: 25px;
      color: #fff;
      font-size: 0.95rem;
      outline: none;
    }
    .search-input::placeholder {
      color: #bbb;
    }
    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
      color: #bbb;
      pointer-events: none;
    }

    /* ======== –°–ü–ò–°–û–ö –ü–õ–ê–ì–ò–ù–û–í ======== */
    #plugin-list {
      display: flex;
      flex-direction: column;
      padding: 10px;
    }
    .plugin-item {
      display: flex;
      align-items: center;
      background: rgba(255,255,255,0.05);
      border: 1px solid #555;
      border-radius: 6px;
      padding: 8px 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.15s;
    }
    .plugin-item:hover {
      background: rgba(255,255,255,0.1);
    }
    .plugin-item img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-right: 12px;
      border: 1px solid #666;
      border-radius: 4px;
      background: #333;
    }
    .plugin-item .name {
      font-size: 1rem;
      color: #eee;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }

    /* ======== DETAIL VIEW (—Å–∫—Ä—ã—Ç –¥–æ –∫–ª–∏–∫–∞) ======== */
    #detail-view {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #222;
      color: #fff;
      display: none;
      flex-direction: column;
      z-index: 20;
      overflow-y: auto;
    }
    #detail-header {
      position: sticky;
      top: 0;
      background: rgba(30,30,30,0.95);
      display: flex;
      align-items: center;
      padding: 10px 15px;
      border-bottom: 1px solid #555;
      z-index: 21;
    }
    #detail-header .back-btn {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.2rem;
      cursor: pointer;
    }

    #detail-content {
      padding: 15px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    /* –†—è–¥ —Å –∏–∫–æ–Ω–∫–æ–π, –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ –∫–Ω–æ–ø–∫–æ–π */
    .icon-row {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    #detail-icon {
      width: 80px;
      height: 80px;
      object-fit: contain;
      margin-right: 15px;
      border: 1px solid #555;
      border-radius: 8px;
      background: #333;
      flex-shrink: 0;
    }
    .title-install {
      display: flex;
      flex-direction: column;
    }
    .detail-name {
      font-size: 1.2rem;
      margin-bottom: 8px;
      color: #eee;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .install-btn {
      font-size: 1.2rem;
      padding: 10px 20px;
      background: linear-gradient(to right, #0f0f0f, #444);
      border: none;
      border-radius: 8px;
      color: #fff;
      cursor: pointer;
      white-space: nowrap;
      align-self: flex-start;
    }
    .install-btn:disabled {
      background: #555;
      cursor: default;
    }
    .installed-label {
      font-size: 1.1rem;
      color: #3af;
      font-weight: bold;
    }
    .delete-btn {
      margin-top: 8px;
      font-size: 1rem;
      padding: 6px 12px;
      background: #660000;
      border: none;
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      width: fit-content;
    }
    .delete-btn:hover {
      background: #880000;
    }

    /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Ä—è–¥ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ (9:16) */
    .screenshots-row {
      display: flex;
      overflow-x: auto;
      margin: 10px 0;
      padding-bottom: 5px;
    }
    .screenshots-row img {
      width: 90px;
      height: 160px; /* —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 9:16 */
      object-fit: cover;
      border: 1px solid #555;
      border-radius: 4px;
      margin-right: 8px;
      cursor: pointer;
      flex-shrink: 0;
    }

    /* –ë–ª–æ–∫ –æ–ø–∏—Å–∞–Ω–∏—è */
    .desc-block {
      margin-top: 10px;
      font-size: 0.95rem;
      line-height: 1.4;
      color: #ddd;
    }

    /* ======== MODAL –î–õ–Ø –£–í–ï–õ–ò–ß–ï–ù–ò–Ø –°–ö–†–ò–ù–ê ======== */
    #img-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    #img-modal img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border: 1px solid #fff;
      border-radius: 4px;
    }
    #img-modal .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 2rem;
      color: #fff;
      background: none;
      border: none;
      cursor: pointer;
    }

    /* ======== –ö–ù–û–ü–ö–ê ¬´?¬ª –í –ù–ò–ñ–ù–ï–ú –ü–†–ê–í–û–ú –£–ì–õ–£ ======== */
    #help-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #000;
      color: #fff;
      border: none;
      border-radius: 20px;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 30;
    }
    #help-button:hover {
      background: #222;
    }
  </style>
</head>
<body>

  <!-- ======= HEADER (–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é) ======= -->
  <header id="main-header">
    <button class="back-btn-main" onclick="goToGlist()">‚Üê</button>
    <h1> GlistPlay  </h1>
    <div class="search-container">
      <input
        type="text"
        id="search-input"
        class="search-input"
        placeholder="–ü–æ–∏—Å–∫ –ø–ª–∞–≥–∏–Ω–æ–≤"
      />
      <span class="search-icon">üîç</span>
    </div>
  </header>

  <!-- ======= –°–ü–ò–°–û–ö –ü–õ–ê–ì–ò–ù–û–í ======= -->
  <div id="plugin-list">
    –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤...
  </div>

  <!-- ======= DETAIL VIEW (—Å–∫—Ä—ã—Ç –¥–æ –∫–ª–∏–∫–∞) ======= -->
  <div id="detail-view">
    <!-- –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π ¬´‚Üê –ù–∞–∑–∞–¥¬ª -->
    <div id="detail-header">
      <button class="back-btn" onclick="closeDetail()">‚Üê</button>
    </div>
    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç: –∏–∫–æ–Ω–∫–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ, –∫–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="detail-content">
      <div class="icon-row">
        <img src="" alt="icon" id="detail-icon" />
        <div class="title-install">
          <div class="detail-name" id="detail-name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞</div>
          <div id="install-panel"></div>
        </div>
      </div>
      <!-- –°–∫—Ä–∏–Ω—à–æ—Ç—ã -->
      <div class="screenshots-row" id="screenshots-row">
        <!-- –ú–∏–Ω–∏–∞—Ç—é—Ä—ã -->
      </div>
      <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
      <div class="desc-block" id="detail-description">
        –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞
      </div>
    </div>
  </div>

  <!-- ======= MODAL –î–õ–Ø –£–í–ï–õ–ò–ß–ï–ù–ò–Ø –°–ö–†–ò–ù–ê ======= -->
  <div id="img-modal">
    <button class="close-modal" onclick="closeModal()">‚úñ</button>
    <img src="" alt="screenshot-large" id="modal-img" />
  </div>

  <!-- ======= –ö–ù–û–ü–ö–ê ¬´?¬ª ======= -->
  <button id="help-button" onclick="openHelp()">?</button>

  <script>
    /* ======== –ù–ê–°–¢–†–û–ô–ö–ò ======== */
    const PLUGIN_LIST_URL = 'https://raw.githubusercontent.com/Vaneyn/glistnet/refs/heads/main/plugins.txt';

    /* ======== –°–û–°–¢–û–Ø–ù–ò–ï ======== */
    let pluginsData = [];
    let filteredPlugins = [];

    /* ======== –ó–ê–ì–†–£–ó–ö–ê –ò –ü–ê–†–°–ò–ù–ì plugins.txt ======== */
    async function loadPlugins() {
      const container = document.getElementById('plugin-list');
      try {
        const resp = await fetch(PLUGIN_LIST_URL);
        if (!resp.ok) throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª ' + resp.status);
        const txt = await resp.text();
        pluginsData = parsePluginList(txt);
        filteredPlugins = pluginsData.slice();
        renderPluginList(filteredPlugins);
      } catch (err) {
        container.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤.';
        console.error(err);
      }
    }

    function parsePluginList(text) {
      const items = [];
      const entries = text.trim().split('\n---\n');
      for (const entry of entries) {
        const lines = entry.trim().split('\n');
        const plugin = { name: '', description: '', code_url: '', icon_url: '', screenshots: [] };
        for (const line of lines) {
          const idx = line.indexOf(':');
          if (idx === -1) continue;
          const key = line.substring(0, idx).trim();
          const val = line.substring(idx + 1).trim();
          if (key === 'name') plugin.name = val;
          else if (key === 'description') plugin.description = val;
          else if (key === 'code_url') plugin.code_url = val;
          else if (key === 'icon_url') plugin.icon_url = val;
          else if (key === 'screenshots') {
            plugin.screenshots = val.split(',').map(s => s.trim()).filter(s => s);
          }
        }
        if (plugin.name && plugin.code_url) {
          items.push(plugin);
        }
      }
      return items;
    }

    /* ======== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ü–ò–°–ö–ê –ü–õ–ê–ì–ò–ù–û–í ======== */
    function renderPluginList(list) {
      const container = document.getElementById('plugin-list');
      container.innerHTML = '';
      if (list.length === 0) {
        container.textContent = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
        return;
      }
      list.forEach((plg, idx) => {
        const item = document.createElement('div');
        item.className = 'plugin-item';
        item.dataset.idx = idx;
        item.innerHTML = `
          <img src="${plg.icon_url}" alt="icon" onerror="this.style.display='none';" />
          <div class="name">${plg.name}</div>
        `;
        item.addEventListener('click', () => openDetailView(plg));
        container.appendChild(item);
      });
    }

    /* ======== –ü–û–ò–°–ö (–ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é) ======== */
    document.getElementById('search-input').addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase();
      filteredPlugins = pluginsData.filter(p =>
        p.name.toLowerCase().includes(q) ||
        p.description.toLowerCase().includes(q)
      );
      renderPluginList(filteredPlugins);
    });

    /* ======== –û–¢–ö–†–´–¢–ò–ï DETAIL VIEW ======== */
    function openDetailView(plugin) {
      // —Å–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
      document.getElementById('plugin-list').style.display = 'none';
      document.getElementById('main-header').style.display = 'none';

      // –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∏–º—è
      document.getElementById('detail-name').textContent = plugin.name;

      // –∏–∫–æ–Ω–∫–∞
      const iconEl = document.getElementById('detail-icon');
      iconEl.src = plugin.icon_url || '';
      iconEl.onerror = () => iconEl.style.display = 'none';

      // —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
      const scrRow = document.getElementById('screenshots-row');
      scrRow.innerHTML = '';
      if (plugin.screenshots && plugin.screenshots.length) {
        plugin.screenshots.forEach(src => {
          const img = document.createElement('img');
          img.src = src;
          img.onerror = () => img.style.display = 'none';
          img.addEventListener('click', () => openModal(src));
          scrRow.appendChild(img);
        });
      }

      // –æ–ø–∏—Å–∞–Ω–∏–µ
      document.getElementById('detail-description').textContent = plugin.description;

      // —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–ª–∏ ¬´–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ¬ª + –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
      const panel = document.getElementById('install-panel');
      panel.innerHTML = '';
      const isInstalled = localStorage.getItem(plugin.name) !== null;
      if (isInstalled) {
        const lbl = document.createElement('div');
        lbl.className = 'installed-label';
        lbl.textContent = '‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
        panel.appendChild(lbl);

        const delBtn = document.createElement('button');
        delBtn.className = 'delete-btn';
        delBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
        delBtn.addEventListener('click', () => {
          localStorage.removeItem(plugin.name);
          closeDetail();
        });
        panel.appendChild(delBtn);
      } else {
        const btn = document.createElement('button');
        btn.className = 'install-btn';
        btn.textContent = '‚¨áÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
        btn.addEventListener('click', async () => {
          btn.disabled = true;
          btn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
          try {
            const res = await fetch(plugin.code_url);
            if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–∞');
            const code = await res.text();
            localStorage.setItem(plugin.name, code);
            // –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º label + –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
            panel.innerHTML = '';
            const lbl2 = document.createElement('div');
            lbl2.className = 'installed-label';
            lbl2.textContent = '‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            panel.appendChild(lbl2);

            const delBtn2 = document.createElement('button');
            delBtn2.className = 'delete-btn';
            delBtn2.textContent = '–£–¥–∞–ª–∏—Ç—å';
            delBtn2.addEventListener('click', () => {
              localStorage.removeItem(plugin.name);
              closeDetail();
            });
            panel.appendChild(delBtn2);
          } catch (err) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–ª–∞–≥–∏–Ω.');
            btn.disabled = false;
            btn.textContent = '‚¨áÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
          }
        });
        panel.appendChild(btn);
      }

      // –ø–æ–∫–∞–∑–∞—Ç—å detail-view
      document.getElementById('detail-view').style.display = 'flex';
    }

    /* ======== –ó–ê–ö–†–´–¢–ò–ï DETAIL VIEW ======== */
    function closeDetail() {
      document.getElementById('detail-view').style.display = 'none';
      document.getElementById('plugin-list').style.display = 'flex';
      document.getElementById('main-header').style.display = 'flex';
    }

    /* ======== MODAL –î–õ–Ø –£–í–ï–õ–ò–ß–ï–ù–ò–Ø –°–ö–†–ò–ù–ê ======== */
    function openModal(src) {
      const modal = document.getElementById('img-modal');
      const modalImg = document.getElementById('modal-img');
      modalImg.src = src;
      modal.style.display = 'flex';
    }
    function closeModal() {
      document.getElementById('img-modal').style.display = 'none';
    }

    /* ======== –ö–ù–û–ü–ö–ê ¬´‚Üê –ù–∞–∑–∞–¥¬ª –í –ì–õ–ê–í–ù–û–ú –ú–ï–ù–Æ ======== */
    function goToGlist() {
      location.href = 'glist.html';
    }

    /* ======== –ö–ù–û–ü–ö–ê ¬´?¬ª ======== */
    function openHelp() {
      location.href = 'mudak.html';
    }

    /* ======== –ù–ê –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´ ======== */
    window.addEventListener('load', loadPlugins);
  </script>
</body>
        </html>
